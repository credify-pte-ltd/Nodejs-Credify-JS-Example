# Credify Integration Sample (Node.js)

:link: [Developers Documentation](https://developers.credify.one/)

This project is an example project of `credify-nodejs`. You can refer a [React Example Project](https://github.com/credify-pte-ltd/React-Credify-JS-Example), too.

Deployed URL: [https://dev-credify-sample.herokuapp.com/](https://dev-credify-sample.herokuapp.com/)

## Endpoints

This project demonstrates 2 roles; data provider and data receiver.

### Data provider

#### `GET: /data-receiver/demo-user`

This returns a random user like following.

```json
{
  "id": 1462,
  "firstName": "Polly",
  "lastName": "Kemmer",
  "email": "Catharine.Dooley88@gmail.com",
  "phoneNumber": "377635294",
  "phoneCountryCode": "+84",
  "creditScore": 338,
  "socialScore": 136,
  "monthlyPaymentAmount": 790414,
  "credifyId": "",
  "createdAt": "2021-02-16T06:03:58.230Z",
  "updatedAt": "2021-02-16T06:03:58.230Z"
}
```

#### `POST: /data-provider/create`

This sets up data provision of a specified user with this data provider's data, BUT the data remains in the data providing service, not in Credify. :closed_lock_with_key:

Request body:

```json
{
  "id": 12,
  "password": "Cred1fy!"  
}
```

Response body:

```json
// ID in Credify system
{
  "id": "011a42b9-62d7-49eb-8328-c2e454af88a1" 
}
```

#### `POST: /data-provider/user-counts`

This returns a total count of eligible users that satisfies a specified criteria.

[Detailed spec is here](https://developers.credify.one/how-to-use-servicex/be-data-provider.html#user-counts-api).

#### `POST: /data-provider/offer-evaluation`

This returns a result of offer evaluation.

[Detailed spec is here](https://developers.credify.one/how-to-use-servicex/be-data-provider.html#offer-evaluation-api).

#### `POST: /data-provider/encrypted-claims`

This encrypts passed claim values with a public key of a data receiver.

[Detailed spec is here](https://developers.credify.one/how-to-use-servicex/be-data-provider.html#encrypted-claims-api).

---

### Data receiver

#### `GET: /data-receiver/oidc`

This generates an URL to kick off an OIDC process.

Query parameters:
- `phone_number (string | undefined) (e.g. 843812345678)` 
- `credify_id (string | undefined)`
- `offer_code (string | undefined)`

Response body:

```json
{
  "url": "https://dev-oidc-core.credify.one/oauth2/auth?client_id=..."    
}
```

[Here is its detail](https://developers.credify.one/how-to-use-servicex/be-data-receiver.html#oidc-setup-url).

#### `POST /data-receiver/oidc`

This handles OIDC callback, receiving `access token` generated by Credify and `state` generated in the initial step.

Request body:

```json
{
  "access_token": "eyj...",
  "state": "xxxxxxxxxx"
}
```

This handles offer redemption or whatever you want with user's data.

## How to run

```shell script
# Clone this projct
$ git clone https://github.com/credify-pte-ltd/credify-nodejs-sample.git

$ cd credify-nodejs-sample

# Install dependencies
$ yarn

# Run a project
$ yarn start
```

Default port is 8000.
